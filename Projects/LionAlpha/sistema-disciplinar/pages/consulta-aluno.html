<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta do Aluno - Portal dos Pais</title>
    <link rel="icon" type="image/jpeg" href="../assets/images/logo-escola.jpeg" style="border-radius: 50%;">
    
    <!-- CSS Externos -->
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/components.css">
    
    <!-- Scripts do Sistema -->
    <script src="../assets/js/local-db.js"></script>
    <script src="../assets/js/local-auth.js"></script>
    <script src="../assets/js/populate-db.js"></script>
    <script defer src="../assets/js/medidas.js"></script>
    
    <!-- jsPDF para exportação -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        /* Estilos específicos para portal dos pais */
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .hero-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            margin: 20px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header-banner {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 40px 20px;
            text-align: center;
            position: relative;
        }

        .header-banner::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 20"><defs><radialGradient id="a" cx="50%" cy="0%" r="100%"><stop offset="0%" stop-color="%23ffffff" stop-opacity="0.1"/><stop offset="100%" stop-color="%23ffffff" stop-opacity="0"/></radialGradient></defs><rect width="100" height="20" fill="url(%23a)"/></svg>') repeat-x;
        }

        .school-logo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 5px solid rgba(255,255,255,0.3);
            margin: 0 auto 20px;
            display: block;
            object-fit: cover;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .school-name {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .school-subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 0;
        }

        .main-content {
            padding: 40px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .insights-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .insight-card {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .insight-card:nth-child(2) {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        }

        .insight-card:nth-child(3) {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        }

        .insight-card:nth-child(4) {
            background: linear-gradient(135deg, #d299c2 0%, #fef9d7 100%);
        }

        .insight-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }

        .insight-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            display: block;
        }

        .insight-value {
            font-size: 2rem;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 8px;
        }

        .insight-label {
            font-size: 1rem;
            color: #4a5568;
            font-weight: 500;
        }

        .search-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .search-title {
            text-align: center;
            margin-bottom: 30px;
            color: #2d3748;
        }

        .search-form {
            max-width: 500px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }

        .form-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .search-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .result-section {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            margin: 20px 0;
            position: relative;
        }
        
        .result-header {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 20px;
        }
        
        .btn-voltar {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }
        
        .btn-voltar:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
        }

        .student-header {
            text-align: center;
            padding: 20px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .student-name {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .student-info {
            opacity: 0.9;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .info-card {
            background: #f8fafc;
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid #667eea;
        }

        .info-title {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .info-content {
            color: #4a5568;
            line-height: 1.6;
        }

        .export-section {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e2e8f0;
        }

        .export-btn {
            padding: 12px 30px;
            background: linear-gradient(45deg, #48bb78, #38a169);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease;
            margin: 0 10px;
        }

        .export-btn:hover {
            transform: translateY(-2px);
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
        }

        .error {
            background: #fed7d7;
            color: #c53030;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .success {
            background: #c6f6d5;
            color: #2f855a;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .footer {
            text-align: center;
            padding: 20px;
            color: white;
            opacity: 0.8;
        }

        /* Estilos da ficha disciplinar (copiados da página de medidas disciplinares) */
        .faltas-resumo, .medidas-resumo {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .resumo-item {
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .resumo-danger { background: linear-gradient(135deg, #dc3545, #e55565); color: white; }
        .resumo-warning { background: linear-gradient(135deg, #ffc107, #ffcd3c); color: #333; }
        .resumo-info { background: linear-gradient(135deg, #17a2b8, #3bc4db); color: white; }
        .resumo-secondary { background: linear-gradient(135deg, #6c757d, #868e96); color: white; }
        
        .resumo-numero {
            display: block;
            font-size: 2.2em;
            font-weight: bold;
            line-height: 1;
        }
        
        .resumo-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-top: 5px;
            display: block;
        }
        
        .faltas-timeline {
            margin-top: 20px;
        }
        
        .faltas-container {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #e9ecef;
            margin-bottom: 20px;
        }
        
        .faltas-titulo {
            background: linear-gradient(135deg, #495057, #6c757d);
            color: white;
            padding: 15px 20px;
            margin: 0;
            font-size: 1.1em;
            font-weight: 600;
        }
        
        .faltas-grid-compacta {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 8px;
            padding: 15px;
            background: #f8f9fa;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .falta-item-compacta {
            display: flex;
            align-items: center;
            padding: 8px 10px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.2s ease;
            font-size: 0.9em;
        }
        
        .falta-item-compacta:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .falta-item-compacta .falta-icon {
            font-size: 1.2em;
            margin-right: 8px;
        }
        
        .falta-item-compacta .falta-data {
            font-weight: bold;
            font-size: 0.85em;
            margin-bottom: 2px;
        }
        
        .falta-item-compacta .falta-tipo {
            font-size: 0.7em;
            font-weight: 600;
        }
        
        .mes-section {
            margin-bottom: 30px;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            overflow: hidden;
        }
        
        .mes-titulo {
            background: linear-gradient(135deg, #495057, #6c757d);
            color: white;
            padding: 12px 20px;
            margin: 0;
            font-size: 1.1em;
            font-weight: 600;
        }
        
        .faltas-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
            padding: 20px;
            background: #f8f9fa;
        }
        
        .falta-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border-radius: 10px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            transition: transform 0.2s ease;
        }
        
        .falta-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .falta-simples {
            background: linear-gradient(135deg, #dc3545, #e55565);
            color: white;
        }
        
        .falta-controlada {
            background: linear-gradient(135deg, #ffc107, #ffcd3c);
            color: #333;
        }
        
        .atestado {
            background: linear-gradient(135deg, #17a2b8, #3bc4db);
            color: white;
        }
        
        .falta-icon {
            font-size: 1.8em;
            margin-right: 12px;
        }
        
        .falta-info {
            flex-grow: 1;
        }
        
        .falta-data {
            font-weight: bold;
            font-size: 1em;
            margin-bottom: 2px;
        }
        
        .falta-tipo {
            font-size: 0.8em;
            font-weight: 600;
            margin-top: 4px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            display: flex;
            align-items: center;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: transform 0.2s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        
        .stat-primary { background: linear-gradient(135deg, #007bff, #0056b3); color: white; }
        .stat-success { background: linear-gradient(135deg, #28a745, #1e7e34); color: white; }
        .stat-danger { background: linear-gradient(135deg, #dc3545, #c82333); color: white; }
        .stat-warning { background: linear-gradient(135deg, #ffc107, #e0a800); color: #333; }
        
        .stat-icon {
            font-size: 2.5em;
            margin-right: 15px;
            opacity: 0.8;
        }
        
        .stat-number {
            font-size: 2.2em;
            font-weight: bold;
            line-height: 1;
            word-break: break-all;
            overflow-wrap: break-word;
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-top: 4px;
        }
        
        .info-box {
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }
        
        .info-success {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .info-box h4 {
            margin: 0 0 10px 0;
            font-size: 1.2em;
        }
        
        .medidas-timeline {
            margin-top: 20px;
        }
        
        .medida-item {
            display: block;
            padding: 15px;
            margin-bottom: 15px;
            background: white;
            border-radius: 12px;
            border-left: 4px solid #ffc107;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .medida-data {
            font-weight: bold;
            color: #495057;
            font-size: 0.9em;
            margin-bottom: 8px;
            display: block;
            text-align: left;
        }
        
        .medida-content {
            text-align: left;
        }
        
        .medida-tipo {
            font-weight: bold;
            color: #dc3545;
            font-size: 1em;
            margin-bottom: 8px;
            word-wrap: break-word;
            overflow-wrap: break-word;
            line-height: 1.3;
        }
        
        .medida-descricao {
            color: #495057;
            margin-bottom: 8px;
            line-height: 1.4;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        .medida-providencias {
            font-size: 0.9em;
            color: #6c757d;
            font-style: italic;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        .nota-disciplinar-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .nota-explicacao {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
        }
        
        .explicacao-titulo {
            font-weight: 600;
            color: #495057;
            margin-bottom: 10px;
            font-size: 1em;
        }
        
        .explicacao-conteudo {
            font-size: 0.9em;
            color: #6c757d;
            line-height: 1.6;
        }
        
        .explicacao-conteudo strong {
            color: #495057;
        }

        /* Estilos para seção de informações adicionais */
        .info-adicional-section {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 50px 20px;
            margin-top: 40px;
        }

        .section-title {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 40px;
            font-size: 2.5em;
            font-weight: bold;
        }

        .info-cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .info-card-large {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .info-card-large:hover {
            transform: translateY(-5px);
        }

        .info-card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .info-icon {
            font-size: 2em;
        }

        .info-card-header h3 {
            margin: 0;
            font-size: 1.3em;
        }

        .info-card-content {
            padding: 25px;
        }

        .links-container {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .info-link {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            text-decoration: none;
            transition: transform 0.3s ease;
            flex: 1;
            text-align: center;
            min-width: 150px;
        }

        .info-link:hover {
            transform: translateY(-2px);
        }

        .info-btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: transform 0.3s ease;
        }

        .info-btn:hover {
            transform: translateY(-2px);
        }

        .classificacao-content,
        .avisos-content {
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            background: #f8f9fa;
        }

        .classificacao-section,
        .aviso-section {
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            margin: 10px;
        }

        .classificacao-titulo {
            margin: 0 0 15px 0;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 1.1em;
        }

        .classificacao-titulo.leve {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            color: #155724;
        }

        .classificacao-titulo.media {
            background: linear-gradient(135deg, #fff3cd, #fde2a3);
            color: #856404;
        }

        .classificacao-titulo.grave {
            background: linear-gradient(135deg, #f8d7da, #f1aeb5);
            color: #721c24;
        }

        .classificacao-lista {
            display: grid;
            gap: 8px;
        }

        .falta-item-class {
            padding: 8px 12px;
            background: #f8f9fa;
            border-left: 4px solid #6c757d;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .aviso-section h4 {
            color: #495057;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .aviso-section ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .aviso-section li {
            margin-bottom: 5px;
            line-height: 1.4;
        }

        /* Garantir rolagem da página */
        html, body {
            overflow-x: hidden !important;
            overflow-y: auto !important;
            height: auto !important;
            min-height: 100vh !important;
        }

        /* Responsividade dos links */
        @media (max-width: 768px) {
            .links-container {
                flex-direction: column;
            }
            
            .info-link {
                min-width: auto;
                flex: none;
            }
        }

        @media (max-width: 768px) {
            .hero-section {
                margin: 10px;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .school-name {
                font-size: 2rem;
            }
            
            .insights-section {
                grid-template-columns: 1fr;
            }
            
            .faltas-grid, .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .faltas-grid-compacta {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 6px;
                padding: 12px;
            }
            
            .falta-item-compacta {
                padding: 6px 8px;
                font-size: 0.8em;
            }
            
            .falta-item-compacta .falta-icon {
                font-size: 1em;
                margin-right: 6px;
            }
            
            .faltas-resumo, .medidas-resumo {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .medida-item {
                padding: 12px;
            }
            
            .medida-data {
                font-size: 0.85em;
                margin-bottom: 6px;
            }
            
            .medida-tipo {
                font-size: 0.95em;
            }
            
            .medida-descricao {
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <div class="hero-section">
        <div class="header-banner">
            <img src="../assets/images/logo-escola.jpeg" alt="Logo da Escola" class="school-logo">
            <h1 class="school-name">Portal dos Pais</h1>
            <p class="school-subtitle">Acompanhe o desenvolvimento do seu filho</p>
        </div>

        <div class="main-content">
            <!-- Seção de Insights Positivos -->
            <div class="insights-section">
                <div class="insight-card">
                    <span class="insight-icon">📈</span>
                    <div class="insight-value" id="frequenciaPositiva">87%</div>
                    <div class="insight-label">Melhoria na Frequência</div>
                </div>
                
                <div class="insight-card">
                    <span class="insight-icon">🏆</span>
                    <div class="insight-value" id="comportamentoPositivo">--</div>
                    <div class="insight-label">Comportamento Exemplar</div>
                </div>
                
                <div class="insight-card">
                    <span class="insight-icon">✅</span>
                    <div class="insight-value" id="participacaoAtiva">--</div>
                    <div class="insight-label">Alunos sem Ocorrências</div>
                </div>
                
                <div class="insight-card">
                    <span class="insight-icon">📅</span>
                    <div class="insight-value" id="reconhecimentos">--</div>
                    <div class="insight-label">Frequência Regular</div>
                </div>
            </div>

            <!-- Seção de Busca -->
            <div class="search-section">
                <h2 class="search-title">🔍 Consulte a Ficha do seu Filho</h2>
                <form class="search-form" id="searchForm">
                    <div class="form-group">
                        <label class="form-label" for="codigoAluno">Código do Aluno:</label>
                        <input type="text" id="codigoAluno" class="form-input" 
                               placeholder="Digite o código do aluno (ex: 1234567)" required>
                    </div>
                    
                    <button type="submit" class="search-btn" id="searchBtn">
                        Buscar Informações
                    </button>
                </form>
            </div>

            <!-- Seção de Resultados -->
            <div class="result-section" id="resultSection">
                <div class="result-header">
                    <button class="btn-voltar" onclick="voltarAoInicio()">
                        ← Consultar Outro Aluno
                    </button>
                </div>
                
                <div class="student-header" id="studentHeader">
                    <div class="student-name" id="studentName"></div>
                    <div class="student-info" id="studentInfo"></div>
                </div>

                <div class="info-grid">
                    <div class="info-card">
                        <div class="info-title">📅 Frequência</div>
                        <div class="info-content" id="frequenciaInfo">Carregando...</div>
                    </div>
                    
                    <div class="info-card">
                        <div class="info-title">⚖️ Situação Disciplinar</div>
                        <div class="info-content" id="disciplinarInfo">Carregando...</div>
                    </div>
                    
                    <div class="info-card">
                        <div class="info-title">🎯 Nota Disciplinar</div>
                        <div class="info-content" id="notaDisciplinar">Carregando...</div>
                    </div>
                    
                    <div class="info-card">
                        <div class="info-title">📊 Resumo Geral</div>
                        <div class="info-content" id="resumoGeral">Carregando...</div>
                    </div>
                </div>

                <div class="export-section">
                    <h3>📋 Relatórios Completos</h3>
                    <p>Baixe o relatório completo com todas as informações:</p>
                    <button class="export-btn" onclick="exportarPDFParaPais()">📄 Baixar PDF</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Container de Informações Adicionais -->
    <div class="info-adicional-section">
        <div class="main-content">
            <h2 class="section-title">📚 Informações Importantes</h2>
            
            <div class="info-cards-grid">
                <!-- Manual e Regulamento -->
                <div class="info-card-large">
                    <div class="info-card-header">
                        <span class="info-icon">📖</span>
                        <h3>Manual e Regulamento</h3>
                    </div>
                    <div class="info-card-content">
                        <p>Consulte o manual completo e regulamento disciplinar da escola para conhecer todas as normas e diretrizes.</p>
                        <div class="links-container">
                            <a href="https://drive.google.com/file/d/14LQpIYD-x81k4-UwFZcJuvN1kyuetshq/view?usp=sharing" class="info-link" target="_blank" rel="noopener noreferrer">
                                📖 Manual da Escola
                            </a>
                            <a href="https://drive.google.com/file/d/1XlJygqsksbywR0EosACPSlwRjEYUJ7UE/view?usp=sharing" class="info-link" target="_blank" rel="noopener noreferrer">
                                ⚖️ Regulamento Disciplinar
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Classificação das Medidas -->
                <div class="info-card-large">
                    <div class="info-card-header">
                        <span class="info-icon">⚖️</span>
                        <h3>Classificação das Medidas Disciplinares</h3>
                    </div>
                    <div class="info-card-content">
                        <button class="info-btn" onclick="toggleMedidasClassificacao()">
                            📋 Ver Classificação das Faltas
                        </button>
                        <div id="medidasClassificacao" class="classificacao-content" style="display: none;">
                            <div class="classificacao-section">
                                <h4 class="classificacao-titulo leve">🟢 Faltas Disciplinares de Natureza Leve</h4>
                                <div class="classificacao-lista">
                                    <div class="falta-item-class">1. Apresentar-se com uniforme diferente do estabelecido</div>
                                    <div class="falta-item-class">2. Apresentar-se com barba ou bigode sem fazer</div>
                                    <div class="falta-item-class">3. Cabelo em desalinho ou fora do padrão</div>
                                    <div class="falta-item-class">4. Chegar atrasado para início das aulas</div>
                                    <div class="falta-item-class">5. Não levar material necessário</div>
                                    <div class="falta-item-class">6. Adentrar dependência sem autorização</div>
                                    <div class="falta-item-class">7. Consumir alimentos durante aula</div>
                                    <div class="falta-item-class">8. Conversar quando estiver em forma</div>
                                    <div class="falta-item-class">9. Não entregar objeto encontrado</div>
                                    <div class="falta-item-class">10. Não retribuir cumprimentos</div>
                                    <div class="falta-item-class">11. Deixar material em local inapropriado</div>
                                    <div class="falta-item-class">12. Descartar lixo inadequadamente</div>
                                    <div class="falta-item-class">13. Dobrar uniforme desfigurando</div>
                                    <div class="falta-item-class">14. Debruçar e dormir durante aulas</div>
                                    <div class="falta-item-class">15. Executar ordem unida displicentemente</div>
                                    <div class="falta-item-class">16. Fazer barulho excessivo</div>
                                    <div class="falta-item-class">17. Não comunicar irregularidade</div>
                                    <div class="falta-item-class">18. Perturbar estudo dos colegas</div>
                                    <div class="falta-item-class">19. Usar publicação estranha em sala</div>
                                    <div class="falta-item-class">20. Retardar atividade sem motivo</div>
                                    <div class="falta-item-class">21. Sentar no chão uniformizado</div>
                                    <div class="falta-item-class">22. Utilizar jogos no colégio</div>
                                    <div class="falta-item-class">23. Piercing/brinco fora padrão (aluna)</div>
                                    <div class="falta-item-class">24. Piercing/brinco (aluno)</div>
                                    <div class="falta-item-class">25. Usar boné/capuz durante atividade</div>
                                    <div class="falta-item-class">26. Ficar em sala nos intervalos</div>
                                </div>
                            </div>

                            <div class="classificacao-section">
                                <h4 class="classificacao-titulo media">🟡 Faltas Disciplinares de Natureza Média</h4>
                                <div class="classificacao-lista">
                                    <div class="falta-item-class">27. Atrasar atendimento ao chamado da direção</div>
                                    <div class="falta-item-class">28. Não comparecer a atividade extraclasse</div>
                                    <div class="falta-item-class">29. Ausentar-se sem autorização de atividades</div>
                                    <div class="falta-item-class">30. Não cumprir medida disciplinar imposta</div>
                                    <div class="falta-item-class">31. Não devolver documento assinado pelo responsável</div>
                                    <div class="falta-item-class">32. Não devolver material da biblioteca no prazo</div>
                                    <div class="falta-item-class">33. Não entregar documento ao responsável</div>
                                    <div class="falta-item-class">34. Não executar tarefa atribuída por autoridade</div>
                                    <div class="falta-item-class">35. Não zelar pela apresentação pessoal</div>
                                    <div class="falta-item-class">36. Dirigir memorial sem autorização devida</div>
                                    <div class="falta-item-class">37. Entrar/sair por local não permitido</div>
                                    <div class="falta-item-class">38. Espalhar boatos ou notícias tendenciosas</div>
                                    <div class="falta-item-class">39. Tocar sirene sem ordem</div>
                                    <div class="falta-item-class">40. Fumar dentro ou nas imediações da escola</div>
                                    <div class="falta-item-class">41. Ingressar sem uniforme regulamentar</div>
                                    <div class="falta-item-class">42. Distribuir publicação contra disciplina</div>
                                    <div class="falta-item-class">43. Contato físico amoroso quando uniformizado</div>
                                    <div class="falta-item-class">44. Não zelar pelo nome da instituição</div>
                                    <div class="falta-item-class">45. Negar-se a participar de eventos oficiais</div>
                                    <div class="falta-item-class">46. Ofender moral por atos ou palavras</div>
                                    <div class="falta-item-class">47. Portar-se inconvenientemente em sala</div>
                                    <div class="falta-item-class">48. Desrespeitar em eventos sociais</div>
                                    <div class="falta-item-class">49. Proferir palavras de baixo calão</div>
                                    <div class="falta-item-class">50. Transação pecuniária não autorizada</div>
                                    <div class="falta-item-class">51. Provocar discórdia entre colegas</div>
                                    <div class="falta-item-class">52. Publicar conteúdo inadequado online</div>
                                    <div class="falta-item-class">53. Retirar objeto sem autorização</div>
                                    <div class="falta-item-class">54. Sair de forma sem autorização</div>
                                    <div class="falta-item-class">55. Entrar/sair de sala sem permissão</div>
                                    <div class="falta-item-class">56. Ser retirado por mau comportamento</div>
                                    <div class="falta-item-class">57. Simular doenças para se esquivar</div>
                                    <div class="falta-item-class">58. Participar de jogos de azar</div>
                                    <div class="falta-item-class">59. Usar instalações sem autorização</div>
                                    <div class="falta-item-class">60. Usar uniforme em ambiente inapropriado</div>
                                    <div class="falta-item-class">61. Usar aparelhos eletrônicos sem autorização</div>
                                    <div class="falta-item-class">62. Usar distintivos indevidamente</div>
                                </div>
                            </div>

                            <div class="classificacao-section">
                                <h4 class="classificacao-titulo grave">🔴 Faltas Disciplinares de Natureza Grave</h4>
                                <div class="classificacao-lista">
                                    <div class="falta-item-class">63. Assinar documento pelo responsável (falsificação)</div>
                                    <div class="falta-item-class">64. Causar danos ao patrimônio da escola</div>
                                    <div class="falta-item-class">65. Causar ou contribuir para acidentes</div>
                                    <div class="falta-item-class">66. Usar meio não permitido em avaliação (cola)</div>
                                    <div class="falta-item-class">67. Denegrir nome da escola por procedimentos</div>
                                    <div class="falta-item-class">68. Desrespeitar, desobedecer autoridades</div>
                                    <div class="falta-item-class">69. Divulgar apologia às drogas/violência</div>
                                    <div class="falta-item-class">70. Entrar/ausentar-se da escola sem autorização</div>
                                    <div class="falta-item-class">71. Extraviar documentos sob responsabilidade</div>
                                    <div class="falta-item-class">72. Faltar com verdade/usar anonimato</div>
                                    <div class="falta-item-class">73. Fazer uso de entorpecentes/bebidas</div>
                                    <div class="falta-item-class">74. Hastear/arriar bandeiras sem autorização</div>
                                    <div class="falta-item-class">75. Instigar colegas a cometer faltas/delitos</div>
                                    <div class="falta-item-class">76. Contato físico com conotação libidinosa</div>
                                    <div class="falta-item-class">77. Usar imagens/vídeos difamatórios</div>
                                    <div class="falta-item-class">78. Praticar Bullying e Cyberbullying</div>
                                    <div class="falta-item-class">79. Pichar ou causar poluição visual/sonora</div>
                                    <div class="falta-item-class">80. Portar objetos que ameacem segurança</div>
                                    <div class="falta-item-class">81. Desrespeitar símbolos nacionais</div>
                                    <div class="falta-item-class">82. Manifestação coletiva prejudicial</div>
                                    <div class="falta-item-class">83. Promover trotes de qualquer natureza</div>
                                    <div class="falta-item-class">84. Envolver-se em rixa/luta corporal</div>
                                    <div class="falta-item-class">85. Manifestação política uniformizado</div>
                                    <div class="falta-item-class">86. Rasurar/alterar documentos</div>
                                    <div class="falta-item-class">87. Representar escola sem autorização</div>
                                    <div class="falta-item-class">88. Distribuir material político-partidário</div>
                                    <div class="falta-item-class">89. Utilizar/subtrair objetos alheios</div>
                                    <div class="falta-item-class">90. Usar processos fraudulentos em trabalhos</div>
                                    <div class="falta-item-class">91. Causar destruição ao patrimônio de terceiros</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Avisos Gerais -->
                <div class="info-card-large">
                    <div class="info-card-header">
                        <span class="info-icon">📢</span>
                        <h3>Avisos Gerais e Obrigações</h3>
                    </div>
                    <div class="info-card-content">
                        <button class="info-btn" onclick="toggleAvisosGerais()">
                            📋 Ver Obrigações e Recomendações
                        </button>
                        <div id="avisosGerais" class="avisos-content" style="display: none;">
                            <div class="aviso-section">
                                <h4>👔 Apresentação Individual</h4>
                                <p>A apresentação individual é fundamental no Sistema Colégio Cívico-Militar.</p>
                            </div>
                            <div class="aviso-section">
                                <h4>📱 Aparelhos Eletrônicos</h4>
                                <p>Uso condicionado à autorização. Fones proibidos durante aulas.</p>
                            </div>
                            <div class="aviso-section">
                                <h4>🚭 Substâncias Proibidas</h4>
                                <p>Bebidas alcoólicas, cigarros e drogas são terminantemente proibidas.</p>
                            </div>
                            <div class="aviso-section">
                                <h4>💕 Relacionamentos</h4>
                                <p>Manifestações de namoro não são permitidas no colégio.</p>
                            </div>
                            <div class="aviso-section">
                                <h4>⏰ Pontualidade</h4>
                                <p><strong>Descumprimento de horários impacta na nota disciplinar!</strong></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>© 2025 Sistema Escolar - Portal dos Pais | Desenvolvido para aproximar famílias e escola</p>
    </div>

    <script>
        // Dados dos alunos carregados diretamente
        let dadosAlunos = null;

        // Aguardar carregamento do sistema
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Portal dos Pais carregado');
            carregarDadosAlunos();
        });

        // Carregar dados dos alunos diretamente do arquivo
        async function carregarDadosAlunos() {
            try {
                console.log('📊 Carregando dados dos alunos...');
                const response = await fetch('../data/db.json');
                const data = await response.json();
                dadosAlunos = data.alunos || {};
                console.log('✅ Dados dos alunos carregados:', Object.keys(dadosAlunos).length, 'alunos');
                updateInsights();
            } catch (error) {
                console.error('Erro ao carregar dados dos alunos:', error);
                updateInsights(); // Mostrar com dados padrão
            }
        }

        // Atualizar insights positivos
        async function updateInsights() {
            try {
                if (dadosAlunos) {
                    const alunos = Object.values(dadosAlunos);
                    const totalAlunos = alunos.length;
                    
                    // Calcular alunos com comportamento exemplar (sem medidas disciplinares)
                    let comportamentoExemplar = 0;
                    let alunosComMedidas = 0;
                    let alunosComFrequenciaRegular = 0;
                    
                    // Carregar dados de medidas disciplinares
                    let todasMedidas = [];
                    try {
                        const response = await fetch('../data/db.json');
                        const data = await response.json();
                        if (data.medidas_disciplinares) {
                            todasMedidas = Object.values(data.medidas_disciplinares);
                        }
                    } catch (error) {
                        console.log('Erro ao carregar medidas:', error);
                    }
                    
                    // Analisar cada aluno
                    for (const aluno of alunos) {
                        // Verificar medidas disciplinares
                        const medidasDoAluno = todasMedidas.filter(medida => 
                            medida.codigo_aluno === aluno.codigo || 
                            medida.nome_aluno === aluno.nome_completo
                        );
                        
                        if (medidasDoAluno.length === 0 && (!aluno.medidas || aluno.medidas.length === 0)) {
                            comportamentoExemplar++;
                        }
                        
                        if (medidasDoAluno.length > 0 || (aluno.medidas && aluno.medidas.length > 0)) {
                            alunosComMedidas++;
                        }
                        
                        // Verificar frequência (assumindo que poucos têm problemas)
                        try {
                            const dadosFreq = await buscarFrequenciaPorCodigo(aluno.codigo);
                            if (!dadosFreq || !dadosFreq.faltas || dadosFreq.faltas.length < 5) {
                                alunosComFrequenciaRegular++;
                            }
                        } catch (error) {
                            // Se não conseguir verificar, considera frequência regular
                            alunosComFrequenciaRegular++;
                        }
                    }

                    // Calcular percentuais
                    const percentualComportamentoExemplar = Math.round((comportamentoExemplar / totalAlunos) * 100);
                    const alunosAtivos = totalAlunos - alunosComMedidas;
                    
                    // Atualizar interface com dados reais
                    document.getElementById('comportamentoPositivo').textContent = percentualComportamentoExemplar + '%';
                    document.getElementById('participacaoAtiva').textContent = alunosAtivos;
                    document.getElementById('reconhecimentos').textContent = alunosComFrequenciaRegular;
                    
                    console.log(`📊 Estatísticas calculadas: ${percentualComportamentoExemplar}% comportamento exemplar, ${alunosAtivos} sem ocorrências, ${alunosComFrequenciaRegular} com frequência regular`);
                } else {
                    // Valores padrão quando dados não estão disponíveis
                    document.getElementById('comportamentoPositivo').textContent = '85%';
                    document.getElementById('participacaoAtiva').textContent = '180';
                    document.getElementById('reconhecimentos').textContent = '200';
                }
                    
            } catch (error) {
                console.log('Erro ao calcular insights:', error);
                // Valores padrão em caso de erro
                document.getElementById('comportamentoPositivo').textContent = '85%';
                document.getElementById('participacaoAtiva').textContent = '180';
                document.getElementById('reconhecimentos').textContent = '200';
            }
        }

        // Formulário de busca
        document.getElementById('searchForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const codigo = document.getElementById('codigoAluno').value.trim();
            
            if (!codigo) {
                showError('Por favor, digite o código do aluno.');
                return;
            }
            
            await buscarAluno(codigo);
        });

        // Buscar aluno
        async function buscarAluno(codigo) {
            const searchBtn = document.getElementById('searchBtn');
            const resultSection = document.getElementById('resultSection');
            
            try {
                // Mostrar loading
                searchBtn.disabled = true;
                searchBtn.textContent = 'Buscando...';
                
                // Garantir que os dados estão carregados
                if (!dadosAlunos) {
                    await carregarDadosAlunos();
                }
                
                // Buscar no dados carregados
                const alunos = Object.values(dadosAlunos || {});
                const alunoEncontrado = alunos.find(aluno => aluno.codigo === codigo);
                
                if (!alunoEncontrado) {
                    showError('Aluno não encontrado. Verifique o código informado.');
                    return;
                }
                
                // Mostrar resultados completos com ficha disciplinar e frequência
                await mostrarFichaDisciplinarCompleta(alunoEncontrado);
                
                // Armazenar dados para exportação
                window.dadosAlunoAtual = alunoEncontrado;
                
                showSuccess('Ficha disciplinar carregada com sucesso!');
                
            } catch (error) {
                console.error('Erro na busca:', error);
                showError('Erro ao buscar informações. Tente novamente.');
            } finally {
                searchBtn.disabled = false;
                searchBtn.textContent = 'Buscar Informações';
            }
        }

        // Mostrar ficha disciplinar completa (igual à página de medidas disciplinares)
        async function mostrarFichaDisciplinarCompleta(aluno) {
            const resultSection = document.getElementById('resultSection');
            
            // Cabeçalho do aluno
            document.getElementById('studentName').textContent = aluno.nome_completo;
            document.getElementById('studentInfo').textContent = 
                `Código: ${aluno.codigo} | Turma: ${aluno.turma || 'Não informada'}`;
            
            // Buscar medidas disciplinares do aluno
            let medidas = [];
            try {
                // Verificar se há medidas no próprio objeto aluno
                if (aluno.medidas && Array.isArray(aluno.medidas)) {
                    medidas = [...aluno.medidas];
                }
                
                // Tentar buscar medidas disciplinares do arquivo db.json
                if (dadosAlunos) {
                    try {
                        const response = await fetch('../data/db.json');
                        const data = await response.json();
                        if (data.medidas_disciplinares) {
                            const medidasExtras = Object.values(data.medidas_disciplinares || {})
                                .filter(medida => medida.codigo_aluno === aluno.codigo);
                            medidas = [...medidas, ...medidasExtras];
                        }
                    } catch (error) {
                        console.log('Erro ao buscar medidas extras:', error);
                    }
                }
                
                console.log(`📋 Encontradas ${medidas.length} medidas para o aluno ${aluno.codigo}`);
                
                // Armazenar medidas para exportação
                window.medidasAtuais = medidas;
                
            } catch (error) {
                console.log('Erro ao buscar medidas:', error);
                window.medidasAtuais = [];
            }
            
            // Buscar dados de frequência usando a mesma lógica da página de medidas
            let dadosFrequencia = null;
            try {
                dadosFrequencia = await buscarFrequenciaPorCodigo(aluno.codigo);
                
                // Armazenar dados de frequência para exportação
                if (dadosFrequencia && dadosFrequencia.faltas) {
                    window.dadosFrequenciaAluno = dadosFrequencia.faltas;
                } else {
                    window.dadosFrequenciaAluno = [];
                }
                
            } catch (error) {
                console.log('Erro ao buscar frequência:', error);
                window.dadosFrequenciaAluno = [];
            }
            
            // Atualizar frequência com detalhes completos
            if (dadosFrequencia && dadosFrequencia.faltas && dadosFrequencia.faltas.length > 0) {
                let frequenciaHtml = `
                    <div class="faltas-resumo">
                        <div class="resumo-item resumo-danger">
                            <span class="resumo-numero">${dadosFrequencia.faltas.filter(f => f.marcacao === 'F').length}</span>
                            <span class="resumo-label">Faltas</span>
                        </div>
                        <div class="resumo-item resumo-warning">
                            <span class="resumo-numero">${dadosFrequencia.faltas.filter(f => f.marcacao === 'FC').length}</span>
                            <span class="resumo-label">Faltas Controladas</span>
                        </div>
                        <div class="resumo-item resumo-info">
                            <span class="resumo-numero">${dadosFrequencia.faltas.filter(f => f.marcacao === 'A').length}</span>
                            <span class="resumo-label">Atestados</span>
                        </div>
                        <div class="resumo-item resumo-secondary">
                            <span class="resumo-numero">${dadosFrequencia.faltas.length}</span>
                            <span class="resumo-label">Total</span>
                        </div>
                    </div>
                    <div class="faltas-timeline">
                `;
                
                // Mostrar todas as faltas em um único container
                frequenciaHtml += `
                    <div class="faltas-container">
                        <h4 class="faltas-titulo">📅 Registro de Faltas</h4>
                        <div class="faltas-grid-compacta">
                `;
                
                dadosFrequencia.faltas.forEach(falta => {
                    const tipoClasse = falta.marcacao === 'F' ? 'falta-simples' : 
                                     falta.marcacao === 'FC' ? 'falta-controlada' : 'atestado';
                    const icone = falta.marcacao === 'F' ? '❌' : 
                                falta.marcacao === 'FC' ? '⚠️' : '🏥';
                    const tipoTexto = falta.marcacao === 'F' ? 'Falta' : 
                                    falta.marcacao === 'FC' ? 'Falta Controlada' : 'Atestado';
                    
                    frequenciaHtml += `
                        <div class="falta-item-compacta ${tipoClasse}">
                            <div class="falta-icon">${icone}</div>
                            <div class="falta-info">
                                <div class="falta-data">${falta.data}</div>
                                <div class="falta-tipo">${tipoTexto}</div>
                            </div>
                        </div>
                    `;
                });
                
                frequenciaHtml += `
                        </div>
                    </div>
                `;
                
                frequenciaHtml += '</div>';
                document.getElementById('frequenciaInfo').innerHTML = frequenciaHtml;
            } else {
                document.getElementById('frequenciaInfo').innerHTML = `
                    <div class="info-box info-success">
                        <h4>✅ Frequência Exemplar!</h4>
                        <p>Este aluno não possui faltas registradas no período</p>
                    </div>
                `;
            }
            
            // Atualizar situação disciplinar com detalhes completos
            if (medidas.length === 0) {
                document.getElementById('disciplinarInfo').innerHTML = `
                    <div class="info-box info-success">
                        <h4>🏆 Comportamento Exemplar!</h4>
                        <p>Este aluno não possui medidas disciplinares registradas</p>
                    </div>
                `;
            } else {
                let disciplinarHtml = `
                    <div class="medidas-resumo">
                        <div class="resumo-item resumo-warning">
                            <span class="resumo-numero">${medidas.length}</span>
                            <span class="resumo-label">Total de Medidas</span>
                        </div>
                    </div>
                    <div class="medidas-timeline">
                `;
                
                // Ordenar medidas por data
                medidas.sort((a, b) => new Date(b.data || b.data_registro) - new Date(a.data || a.data_registro));
                
                medidas.forEach(medida => {
                    const dataFormatada = medida.data ? new Date(medida.data).toLocaleDateString('pt-BR') : 
                                         medida.data_registro ? new Date(medida.data_registro).toLocaleDateString('pt-BR') : 'Data não informada';
                    
                    disciplinarHtml += `
                        <div class="medida-item">
                            <div class="medida-data">📅 ${dataFormatada}</div>
                            <div class="medida-content">
                                <div class="medida-tipo">${medida.tipo_medida || medida.tipo || 'Não informado'}</div>
                                <div class="medida-descricao">${medida.especificacao || medida.descricao_falta || medida.motivo || 'Não informado'}</div>
                                ${medida.observacao || medida.providencias_tomadas ? 
                                  `<div class="medida-providencias"><strong>Providências:</strong> ${medida.observacao || medida.providencias_tomadas}</div>` : ''}
                            </div>
                        </div>
                    `;
                });
                
                disciplinarHtml += '</div>';
                document.getElementById('disciplinarInfo').innerHTML = disciplinarHtml;
            }
            
            // Calcular nota disciplinar correta
            const notaCalculada = calcularNotaDisciplinarAluno(aluno, medidas);
            const notaExibir = notaCalculada || 8.0;
            
            document.getElementById('notaDisciplinar').innerHTML = `
                <div class="nota-disciplinar-container">
                    <div class="stat-card stat-${notaExibir >= 8 ? 'success' : notaExibir >= 6 ? 'warning' : 'danger'}">
                        <div class="stat-icon">${notaExibir >= 8 ? '⭐' : notaExibir >= 6 ? '👍' : '⚠️'}</div>
                        <div class="stat-content">
                            <div class="stat-number">${notaExibir.toFixed(1)}</div>
                            <div class="stat-label">${notaExibir >= 8 ? 'Excelente' : notaExibir >= 6 ? 'Satisfatório' : 'Precisa melhorar'}</div>
                        </div>
                    </div>
                    <div class="nota-explicacao">
                        <div class="explicacao-titulo">📚 Como funciona a Nota Disciplinar?</div>
                        <div class="explicacao-conteudo">
                            • <strong>Nota inicial:</strong> 8,0 pontos para todos os alunos<br>
                            • <strong>Comportamentos positivos:</strong> +0,1 ponto<br>
                            • <strong>Advertências:</strong> -0,3 pontos<br>
                            • <strong>Suspensões:</strong> -0,5 pontos por dia<br>
                            • <strong>Ações educativas:</strong> -1,0 ponto<br>
                            • <strong>Nota mínima:</strong> 2,0 pontos
                        </div>
                    </div>
                </div>
            `;
            
            // Resumo geral com estatísticas
            const resumoHtml = `
                <div class="stats-grid">
                    <div class="stat-card stat-primary">
                        <div class="stat-icon">👤</div>
                        <div class="stat-content">
                            <div class="stat-number">${aluno.turma || 'N/A'}</div>
                            <div class="stat-label">Turma</div>
                        </div>
                    </div>
                    <div class="stat-card stat-warning">
                        <div class="stat-icon">⚖️</div>
                        <div class="stat-content">
                            <div class="stat-number">${medidas.length}</div>
                            <div class="stat-label">Medidas Disciplinares</div>
                        </div>
                    </div>
                    <div class="stat-card stat-danger">
                        <div class="stat-icon">❌</div>
                        <div class="stat-content">
                            <div class="stat-number">${dadosFrequencia && dadosFrequencia.faltas ? dadosFrequencia.faltas.length : 0}</div>
                            <div class="stat-label">Faltas Registradas</div>
                        </div>
                    </div>
                    <div class="stat-card stat-info">
                        <div class="stat-icon">🎯</div>
                        <div class="stat-content">
                            <div class="stat-number" style="font-size: 1.8em;">${aluno.codigo}</div>
                            <div class="stat-label">Código</div>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('resumoGeral').innerHTML = resumoHtml;
            
            // Mostrar seção de resultados
            resultSection.style.display = 'block';
            resultSection.scrollIntoView({ behavior: 'smooth' });
        }

        // Buscar frequência por código (baseada na página de medidas disciplinares)
        async function buscarFrequenciaPorCodigo(codigo) {
            try {
                console.log('🔍 Buscando frequência para código:', codigo);
                
                const response = await fetch('../assets/js/dados-frequencia-agosto.js');
                if (!response.ok) {
                    throw new Error('Erro ao carregar arquivo: ' + response.status);
                }
                
                const jsContent = await response.text();
                
                // Extrair dados CSV
                const csvMatch = jsContent.match(/const dadosCSV = `([^`]+)`/);
                if (!csvMatch || !csvMatch[1]) {
                    throw new Error('Dados CSV não encontrados no arquivo');
                }
                
                const csvData = csvMatch[1];
                const linhas = csvData.trim().split('\n');
                
                // Buscar linha do aluno
                let linhaAluno = null;
                for (let linha of linhas) {
                    if (linha.startsWith(codigo + ',')) {
                        linhaAluno = linha;
                        break;
                    }
                }
                
                if (!linhaAluno) {
                    return null; // Aluno não encontrado no arquivo de frequência
                }
                
                const campos = linhaAluno.split(',');
                const nome = campos[1];
                const turma = campos[2];
                const diasAgosto = [1, 4, 5, 6, 7, 8, 11, 12, 13, 14, 15, 18, 19, 20, 21, 22, 25, 26, 27, 28, 29];
                
                const faltas = [];
                for (let i = 3; i < campos.length && i - 3 < diasAgosto.length; i++) {
                    const marcacao = campos[i];
                    if (marcacao === 'F' || marcacao === 'FC' || marcacao === 'A') {
                        const dia = diasAgosto[i - 3];
                        faltas.push({
                            dia: dia,
                            marcacao: marcacao,
                            data: `${dia.toString().padStart(2, '0')}/08`
                        });
                    }
                }
                
                return {
                    nome: nome,
                    turma: turma,
                    codigo: codigo,
                    faltas: faltas
                };
                
            } catch (error) {
                console.error('❌ Erro ao buscar frequência:', error);
                return null;
            }
        }

        // Gerar resumo positivo
        function gerarResumoPositivo(aluno, dadosFrequencia) {
            const aspectosPositivos = [];
            
            // Frequência
            if (!dadosFrequencia || !dadosFrequencia.faltas || dadosFrequencia.faltas.length < 3) {
                aspectosPositivos.push('📅 Frequência regular');
            }
            
            // Disciplina
            const medidas = aluno.medidas || [];
            if (medidas.length === 0) {
                aspectosPositivos.push('🏆 Comportamento exemplar');
            } else if (medidas.length <= 2) {
                aspectosPositivos.push('👍 Disciplina adequada');
            }
            
            // Nota
            const nota = aluno.nota_disciplinar || 10;
            if (nota >= 8) {
                aspectosPositivos.push('⭐ Excelente desempenho disciplinar');
            }
            
            // Engajamento
            aspectosPositivos.push('🎯 Aluno participativo');
            
            return aspectosPositivos.join('<br>');
        }

        // Exportação para pais (sem dados sensíveis)
        async function exportarPDFParaPais() {
            if (!window.dadosAlunoAtual) {
                showError('Nenhum aluno selecionado.');
                return;
            }
            
            try {
                // Verificar se jsPDF está disponível
                if (typeof window.jsPDF === 'undefined') {
                    // Carregar jsPDF dinamicamente
                    await carregarJsPDF();
                }
                
                // Gerar PDF específico para consulta dos pais
                await gerarPDFConsultaPais();
                
            } catch (error) {
                console.error('Erro na exportação:', error);
                showError('Erro ao gerar PDF. Tente novamente.');
            }
        }
        
        // Carregar jsPDF dinamicamente
        async function carregarJsPDF() {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
                script.onload = () => {
                    window.jsPDF = window.jspdf.jsPDF;
                    resolve();
                };
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }
        
        // Gerar PDF específico para consulta dos pais
        async function gerarPDFConsultaPais() {
            const aluno = window.dadosAlunoAtual;
            const medidas = window.medidasAtuais || [];
            
            console.log('🔍 Debug PDF - Dados do aluno:', aluno);
            console.log('🔍 Debug PDF - Medidas:', medidas);
            console.log('🔍 Debug PDF - Frequência:', window.dadosFrequenciaAluno);
            
            // Criar novo documento PDF
            const doc = new window.jsPDF();
            const pageWidth = doc.internal.pageSize.width;
            const pageHeight = doc.internal.pageSize.height;
            const margin = 20;
            const contentWidth = pageWidth - (margin * 2);
            
            let yPos = margin;
            
            // Função para adicionar nova página se necessário
            function checkNewPage(neededSpace = 20) {
                if (yPos + neededSpace > pageHeight - margin) {
                    doc.addPage();
                    yPos = margin;
                    return true;
                }
                return false;
            }
            
            // Cabeçalho principal
            doc.setFontSize(22);
            doc.setTextColor(41, 49, 80);
            doc.setFont("helvetica", "bold");
            
            // Título centralizado
            const titulo = "FICHA DISCIPLINAR DO ALUNO";
            const tituloWidth = doc.getTextWidth(titulo);
            const tituloX = (pageWidth - tituloWidth) / 2;
            doc.text(titulo, tituloX, yPos);
            
            yPos += 10;
            
            // Data de geração
            doc.setFontSize(12);
            doc.setTextColor(108, 117, 125);
            doc.setFont("helvetica", "normal");
            const dataGeracao = `Gerado em: ${new Date().toLocaleDateString('pt-BR')} às ${new Date().toLocaleTimeString('pt-BR')}`;
            const dataWidth = doc.getTextWidth(dataGeracao);
            const dataX = (pageWidth - dataWidth) / 2;
            doc.text(dataGeracao, dataX, yPos);
            
            yPos += 20;
            
            // Linha divisória
            doc.setDrawColor(200, 200, 200);
            doc.setLineWidth(0.5);
            doc.line(margin, yPos, pageWidth - margin, yPos);
            yPos += 20;
            
            // SEÇÃO: Dados do Aluno
            doc.setFontSize(16);
            doc.setTextColor(41, 49, 80);
            doc.setFont("helvetica", "bold");
            doc.text("DADOS DO ALUNO", margin, yPos);
            yPos += 15;
            
            // Box com dados do aluno
            doc.setDrawColor(230, 230, 230);
            doc.setFillColor(248, 249, 250);
            const boxHeight = 35;
            doc.rect(margin, yPos - 5, contentWidth, boxHeight, 'FD');
            
            doc.setFontSize(12);
            doc.setTextColor(33, 37, 41);
            doc.setFont("helvetica", "normal");
            
            // Dados em duas colunas
            const colWidth = contentWidth / 2;
            doc.text(`Nome: ${aluno.nome_completo}`, margin + 5, yPos + 5);
            doc.text(`Código: ${aluno.codigo}`, margin + colWidth + 5, yPos + 5);
            doc.text(`Turma: ${aluno.turma}`, margin + 5, yPos + 15);
            doc.text(`Responsável: ${aluno.responsavel}`, margin + colWidth + 5, yPos + 15);
            
            yPos += boxHeight + 20;
            
            // SEÇÃO: Nota Disciplinar
            checkNewPage(30);
            doc.setFontSize(16);
            doc.setTextColor(41, 49, 80);
            doc.setFont("helvetica", "bold");
            doc.text("AVALIAÇÃO DISCIPLINAR", margin, yPos);
            yPos += 15;
            
            const notaAtual = calcularNotaDisciplinar();
            const notaFormatada = typeof notaAtual === 'number' ? notaAtual.toFixed(1) : '8.0';
            
            // Box da nota
            doc.setDrawColor(40, 167, 69);
            doc.setFillColor(212, 237, 218);
            doc.rect(margin, yPos - 5, contentWidth, 20, 'FD');
            
            doc.setFontSize(14);
            doc.setTextColor(25, 135, 84);
            doc.setFont("helvetica", "bold");
            const notaText = `Nota Disciplinar: ${notaFormatada} / 10,0 pontos`;
            const notaTextWidth = doc.getTextWidth(notaText);
            const notaX = (pageWidth - notaTextWidth) / 2;
            doc.text(notaText, notaX, yPos + 8);
            
            yPos += 30;
            
            // SEÇÃO: Medidas Disciplinares
            checkNewPage(40);
            doc.setFontSize(16);
            doc.setTextColor(41, 49, 80);
            doc.setFont("helvetica", "bold");
            doc.text("HISTÓRICO DISCIPLINAR", margin, yPos);
            yPos += 15;
            
            if (medidas.length > 0) {
                medidas.forEach((medida, index) => {
                    checkNewPage(40);
                    
                    // Header da medida
                    doc.setDrawColor(220, 53, 69);
                    doc.setFillColor(248, 215, 218);
                    doc.rect(margin, yPos - 3, contentWidth, 12, 'FD');
                    
                    doc.setFontSize(11);
                    doc.setTextColor(220, 53, 69);
                    doc.setFont("helvetica", "bold");
                    doc.text(`${index + 1}. ${medida.data || 'Data não informada'}`, margin + 3, yPos + 5);
                    yPos += 18;
                    
                    // Tipo da medida
                    doc.setFontSize(12);
                    doc.setTextColor(33, 37, 41);
                    doc.setFont("helvetica", "bold");
                    const tipoLines = doc.splitTextToSize(`Tipo: ${medida.tipo || 'Não especificado'}`, contentWidth - 10);
                    doc.text(tipoLines, margin + 5, yPos);
                    yPos += tipoLines.length * 6 + 5;
                    
                    // Descrição
                    if (medida.descricao && medida.descricao.trim()) {
                        doc.setFont("helvetica", "normal");
                        doc.setTextColor(108, 117, 125);
                        const descLines = doc.splitTextToSize(`Descrição: ${medida.descricao}`, contentWidth - 10);
                        doc.text(descLines, margin + 5, yPos);
                        yPos += descLines.length * 5 + 5;
                    }
                    
                    // Professor responsável
                    if (medida.professor && medida.professor.trim()) {
                        doc.setFont("helvetica", "italic");
                        doc.setTextColor(108, 117, 125);
                        doc.text(`Professor: ${medida.professor}`, margin + 5, yPos);
                        yPos += 8;
                    }
                    
                    yPos += 10; // Espaçamento entre medidas
                });
            } else {
                // Mensagem quando não há medidas
                doc.setDrawColor(40, 167, 69);
                doc.setFillColor(212, 237, 218);
                doc.rect(margin, yPos - 5, contentWidth, 25, 'FD');
                
                doc.setFontSize(14);
                doc.setTextColor(25, 135, 84);
                doc.setFont("helvetica", "bold");
                const msgPositiva = "Nenhuma medida disciplinar registrada";
                const msgWidth = doc.getTextWidth(msgPositiva);
                const msgX = (pageWidth - msgWidth) / 2;
                doc.text(msgPositiva, msgX, yPos + 8);
                
                doc.setFontSize(12);
                doc.setFont("helvetica", "normal");
                const parabenText = "Parabéns pelo excelente comportamento!";
                const parabenWidth = doc.getTextWidth(parabenText);
                const parabenX = (pageWidth - parabenWidth) / 2;
                doc.text(parabenText, parabenX, yPos + 18);
                
                yPos += 30;
            }
            
            // SEÇÃO: Frequência (se disponível)
            if (window.dadosFrequenciaAluno && window.dadosFrequenciaAluno.length > 0) {
                checkNewPage(40);
                
                doc.setFontSize(16);
                doc.setTextColor(41, 49, 80);
                doc.setFont("helvetica", "bold");
                doc.text("RESUMO DE FREQUÊNCIA", margin, yPos);
                yPos += 15;
                
                const frequencia = window.dadosFrequenciaAluno;
                const totalDias = frequencia.length;
                
                // Contar baseado na marcação (F = Falta, P = Presente, etc)
                const faltas = frequencia.filter(d => d.marcacao === 'F').length;
                const presencas = frequencia.filter(d => d.marcacao === 'P').length;
                const atestados = frequencia.filter(d => d.marcacao === 'A').length;
                
                const diasComputados = presencas + faltas; // Não contar atestados
                const percentualFrequencia = diasComputados > 0 ? (presencas / diasComputados * 100) : 100;
                
                // Box da frequência
                const corFrequencia = percentualFrequencia >= 75 ? [40, 167, 69] : [220, 53, 69];
                const bgFrequencia = percentualFrequencia >= 75 ? [212, 237, 218] : [248, 215, 218];
                
                doc.setDrawColor(...corFrequencia);
                doc.setFillColor(...bgFrequencia);
                doc.rect(margin, yPos - 5, contentWidth, 40, 'FD');
                
                doc.setFontSize(12);
                doc.setTextColor(...corFrequencia);
                doc.setFont("helvetica", "bold");
                
                doc.text(`Total de dias letivos: ${totalDias}`, margin + 10, yPos + 5);
                doc.text(`Presenças: ${presencas}`, margin + 10, yPos + 15);
                doc.text(`Faltas: ${faltas}`, margin + 10, yPos + 25);
                if (atestados > 0) {
                    doc.text(`Atestados: ${atestados}`, margin + 10, yPos + 35);
                }
                
                // Percentual em destaque
                doc.setFontSize(14);
                doc.text(`Percentual de frequência: ${percentualFrequencia.toFixed(1)}%`, margin + 10, yPos + (atestados > 0 ? 50 : 40));
                
                yPos += (atestados > 0 ? 60 : 50);
            }
            
            // Rodapé em todas as páginas
            const totalPages = doc.internal.getNumberOfPages();
            for (let i = 1; i <= totalPages; i++) {
                doc.setPage(i);
                
                // Linha do rodapé
                doc.setDrawColor(200, 200, 200);
                doc.setLineWidth(0.5);
                doc.line(margin, pageHeight - 25, pageWidth - margin, pageHeight - 25);
                
                // Texto do rodapé
                doc.setFontSize(9);
                doc.setTextColor(150, 150, 150);
                doc.setFont("helvetica", "normal");
                
                const rodapeEsquerda = "Dashboard Disciplinar - Sistema de Gestão Escolar";
                doc.text(rodapeEsquerda, margin, pageHeight - 15);
                
                const rodapeDireita = `Página ${i} de ${totalPages}`;
                const rodapeWidth = doc.getTextWidth(rodapeDireita);
                doc.text(rodapeDireita, pageWidth - margin - rodapeWidth, pageHeight - 15);
            }
            
            // Salvar PDF
            const nomeArquivo = `ficha_disciplinar_${aluno.codigo}_${new Date().toISOString().slice(0, 10)}.pdf`;
            doc.save(nomeArquivo);
            
            showSuccess('PDF gerado com sucesso!');
        }


        // Funções de feedback
        function showError(message) {
            const existing = document.querySelector('.error');
            if (existing) existing.remove();
            
            const error = document.createElement('div');
            error.className = 'error';
            error.textContent = message;
            
            const searchSection = document.querySelector('.search-section');
            searchSection.appendChild(error);
            
            setTimeout(() => error.remove(), 5000);
        }

        function showSuccess(message) {
            const existing = document.querySelector('.success');
            if (existing) existing.remove();
            
            const success = document.createElement('div');
            success.className = 'success';
            success.textContent = message;
            
            const searchSection = document.querySelector('.search-section');
            searchSection.appendChild(success);
            
            setTimeout(() => success.remove(), 3000);
        }
        
        // Função para calcular pontos de uma medida (copiada da página de medidas disciplinares)
        function calcularPontosMedida(tipoMedida, diasSuspensao = 1) {
            if (!tipoMedida) return 0;
            
            // Normalizar o tipo de medida para minúsculas e remover acentos/espaços extras
            const tipoNormalizado = tipoMedida.toLowerCase()
                .normalize('NFD')
                .replace(/[\u0300-\u036f]/g, '') // Remove acentos
                .replace(/\s+/g, ' ') // Normaliza espaços
                .trim();
            
            // Mapeamento flexível de tipos de medida
            const mapeamentos = {
                // Tipos positivos
                'fato observado positivo': 0.1,
                'fato positivo': 0.1,
                'comportamento positivo': 0.1,
                'observacao positiva': 0.1,
                'elogio': 0.1,
                
                // Tipos negativos
                'fato observado negativo': -0.1,
                'fato negativo': -0.1,
                'comportamento negativo': -0.1,
                'observacao negativa': -0.1,
                'ocorrencia': -0.1,
                
                // Advertências
                'advertencia verbal': -0.3,
                'advertencia escrita': -0.3,
                'advertencia': -0.3,
                'adv verbal': -0.3,
                'adv escrita': -0.3,
                'chamada atencao': -0.3,
                
                // Suspensões
                'suspensao': -0.5 * parseInt(diasSuspensao || 1),
                'suspensao temporaria': -0.5 * parseInt(diasSuspensao || 1),
                'afastamento': -0.5 * parseInt(diasSuspensao || 1),
                
                // Ações educativas
                'acao educativa': -1.0,
                'medida educativa': -1.0,
                'atividade educativa': -1.0,
                'trabalho educativo': -1.0,
                'orientacao educativa': -1.0,
                'encaminhamento': -1.0
            };
            
            // Buscar correspondência exata ou parcial
            let pontos = mapeamentos[tipoNormalizado];
            
            // Se não encontrou correspondência exata, tentar busca parcial
            if (pontos === undefined) {
                for (const [tipo, valor] of Object.entries(mapeamentos)) {
                    if (tipoNormalizado.includes(tipo) || tipo.includes(tipoNormalizado)) {
                        pontos = valor;
                        break;
                    }
                }
            }
            
            return pontos || 0;
        }

        // Função para calcular nota disciplinar de um aluno
        function calcularNotaDisciplinarAluno(aluno, medidas) {
            try {
                let notaBase = 8.0; // Nota inicial sempre 8
                
                // Calcular pontos das medidas
                let totalPontos = 0;
                medidas.forEach(medida => {
                    const pontos = calcularPontosMedida(medida.tipo_medida || medida.tipo, medida.dias_suspensao);
                    totalPontos += pontos;
                });

                // Nota final = nota base + pontos acumulados (não pode ser menor que 0)
                const notaFinal = Math.max(0, notaBase + totalPontos);
                return Math.round(notaFinal * 10) / 10; // Arredondar para 1 casa decimal
                
            } catch (error) {
                console.error('Erro ao calcular nota disciplinar:', error);
                return 8.0; // Retorna nota inicial em caso de erro
            }
        }

        // Função para voltar ao início
        function voltarAoInicio() {
            const resultSection = document.getElementById('resultSection');
            const searchSection = document.querySelector('.search-section');
            
            // Esconder seção de resultados
            resultSection.style.display = 'none';
            
            // Limpar formulário
            document.getElementById('codigoAluno').value = '';
            
            // Rolar para o formulário de busca
            searchSection.scrollIntoView({ behavior: 'smooth' });
            
            // Focar no campo de código
            setTimeout(() => {
                document.getElementById('codigoAluno').focus();
            }, 500);
        }
        
        // Função para mostrar/esconder classificação das medidas
        function toggleMedidasClassificacao() {
            const content = document.getElementById('medidasClassificacao');
            const btn = event.target;
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                btn.textContent = '📋 Ocultar Classificação das Faltas';
            } else {
                content.style.display = 'none';
                btn.textContent = '📋 Ver Classificação das Faltas';
            }
        }
        
        // Função para mostrar/esconder avisos gerais
        function toggleAvisosGerais() {
            const content = document.getElementById('avisosGerais');
            const btn = event.target;
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                btn.textContent = '📋 Ocultar Obrigações e Recomendações';
            } else {
                content.style.display = 'none';
                btn.textContent = '📋 Ver Obrigações e Recomendações';
            }
        }
    </script>
</body>
</html>
