<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Limpar Tudo</title>
  <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script defer src="assets/js/firebase-config.js"></script>
</head>
<body>
  <h1>ğŸ§¹ LIMPAR TODOS OS DADOS DE FREQUÃŠNCIA</h1>
  <button id="btnLimpar" style="background: red; color: white; padding: 15px 30px; font-size: 18px;">
    ğŸ—‘ï¸ DELETAR TUDO RELACIONADO Ã€ FREQUÃŠNCIA
  </button>
  <div id="output" style="white-space: pre-wrap; font-family: monospace; margin-top: 20px;"></div>

  <script>
    document.getElementById('btnLimpar').addEventListener('click', async function() {
      const output = document.getElementById('output');
      
      if (!confirm('TEM CERTEZA? Isso vai deletar TUDO relacionado Ã  frequÃªncia!')) {
        return;
      }
      
      // Aguardar Firebase estar pronto
      while (!window.db) {
        await new Promise(resolve => setTimeout(resolve, 100));
      }
      
      output.innerHTML = "ğŸ§¹ LIMPANDO TODOS OS DADOS DE FREQUÃŠNCIA...\n\n";
      
      try {
        // 1. Deletar coleÃ§Ã£o frequencia
        const frequenciaSnapshot = await db.collection('frequencia').get();
        output.innerHTML += `ğŸ“„ Deletando ${frequenciaSnapshot.docs.length} documentos da coleÃ§Ã£o frequencia...\n`;
        
        for (const doc of frequenciaSnapshot.docs) {
          // Deletar subcoleÃ§Ã£o alunos primeiro
          const alunosSnapshot = await doc.ref.collection('alunos').get();
          const batch1 = db.batch();
          alunosSnapshot.docs.forEach(alunoDoc => {
            batch1.delete(alunoDoc.ref);
          });
          if (alunosSnapshot.docs.length > 0) {
            await batch1.commit();
          }
          
          // Deletar documento principal
          await doc.ref.delete();
          output.innerHTML += `   âœ… ${doc.id} deletado\n`;
        }
        
        output.innerHTML += "âœ… LIMPEZA CONCLUÃDA!\n\n";
        output.innerHTML += "ğŸ¯ AGORA VOCÃŠ PODE CRIAR UMA NOVA PÃGINA DE FREQUÃŠNCIA DO ZERO!\n";
        
      } catch (error) {
        output.innerHTML += `âŒ ERRO: ${error.message}\n`;
        console.error(error);
      }
    });
  </script>
</body>
</html>